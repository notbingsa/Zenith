<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenith</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Exo 2"', 'sans-serif'],
                    },
                    colors: {
                        'zenith-dark': '#0c0a09',
                        'zenith-blue': '#3b82f6',
                        'zenith-purple': '#7c3aed',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Exo 2', sans-serif;
        }

        .dark-gradient-bg {
            background: linear-gradient(180deg, #111827 0%, #0c0a09 100%);
            min-height: 10vh;
        }

        .zenith-title-glow {
            background-image: linear-gradient(to right, #7c3aed, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            text-shadow:
                0 0 5px rgba(59, 130, 246, 0.3),
                0 0 20px rgba(124, 58, 237, 0.5);
            color: #ffffff;
        }

        .section-heading-glow {
            text-shadow: 0 0 10px #7c3aed;
            color: #d1d5db;
        }

        .asset-card-shadow {
            box-shadow: 0 10px 15px rgba(124, 58, 237, 0.3), 0 4px 6px rgba(59, 130, 246, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .asset-card-shadow:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 25px rgba(124, 58, 237, 0.5), 0 6px 10px rgba(59, 130, 246, 0.2);
        }

        .fullscreen-button {
            position: relative;
            background-color: rgba(107, 114, 128, 0.9);
            color: white;
            padding: 0;
            height: 40px;
            width: 40px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: none;
            margin-left: 10px;
        }

        .fullscreen-button:hover {
            background-color: rgba(107, 114, 128, 1);
        }

        .asset-control-bar {
            position: absolute;
            top: auto;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            z-index: 40;
            background-color: #1f2937;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 10px;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.4);
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1rem;
        }

        .asset-iframe-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 50px;
            background-color: black;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #loading-overlay {
            border-radius: 1rem;
        }

        .rounded-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #7c3aed;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .full-view {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
            border-radius: 0 !important;
            max-width: none !important;
            box-shadow: none !important;
        }

        .full-view .asset-control-bar {
            border-radius: 0 !important;
        }

        #tester-loading-banner {
            z-index: 45;
        }
    </style>
    <script>
        let mainPanel, renderTarget, labelRegistry, primaryMarker;
        let testerLoadCount = 0;
        let testerTotalAssets = 0;
        let testerAssetList = [];
        const ZENITH_TITLE = 'Zenith';
        const RANDOM_PICKS = 'Random Picks';
        const HOMEPAGE_TITLE = 'Homepage';
        const TITLE_SUFFIX = 'Unblocked Games';
        const TAGLINES = [
            'We are doing our work... just not the teachers.',
            'This is the only reason keeping me in school.',
            '"A student\'s dream" - some random student that doesn\'t exist',
            'We know you didn\'t get here accidentally.',
            'What asset shall you pick?',
        ];
        const LOAD_ASSET = 'processMatrix';
        const LOAD_FNF_VARIANT = 'executeVariant';
        const GAME_CATEGORY = 'Game';
        const APP_CATEGORY = 'App';
        const ADFOAI_TITLE = 'A Dance of Fire and Ice';
        const ADFOAI_WIDTH = '800px';
        const ADFOAI_HEIGHT = '400px';
        const SECRET_CODE = 'tester';

        function decodeTitle(asset) {
            if (asset.g === GAME_CATEGORY) {
                try {
                    return atob(asset.t);
                } catch (e) {
                    return 'Decode Error';
                }
            }
            return asset.t;
        }

        const ALL_ASSETS = [
            { id: 1, t: 'Q2hhdA==', u: 'aHR0cHM6Ly9wYWRsZXQuY29tL2xpbmNvbG5oYXJyaXNvbjhwYy96ZW5pdGg=', c: '7c3aed', y: LOAD_ASSET, g: APP_CATEGORY, i: 'https://notbingsa.github.io/Zenith/apps/images/Chat.png' },
            { id: 2, t: 'VW5ibG9ja2Vy', u: 'aHR0cHM6Ly9ob21lbWF0aC5uczAuaXQ=', c: 'f97316', y: LOAD_ASSET, g: APP_CATEGORY, i: 'https://notbingsa.github.io/Zenith/apps/images/Unblocker.png' },
            { id: 3, t: 'QSBEYW5jZSBvZiBGcmUgYW5kIEljZQ==', u: 'aHR0cHM6Ly9nYW1lMjIxNTU1LmtvbmdnYW1lcy5jb20vZ2FtZXovMDAyMi8xNTU1L2xpdmUvaW5kZXguaHRtbA==', c: 'ef4444', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/A%20Dance%20of%20Fire%20and%20Ice.png' },
            { id: 4, t: 'Qml0bGlmZQ==', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL2JpdGxpZmUv', c: 'ef4444', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Bitlife.png' },
            { id: 5, t: 'QmxvY2sgQmxhc3Q=', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL0Jsb2NrJTIwQmxhc3QuaHRtbA==', c: '1d4ed8', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Block%20Blast.png' },
            { id: 6, t: 'Qm91bmNlbWFzdGVycw==', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL0JvdW5jZW1hc3RlcnMuaHRtbA==', c: 'f97316', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Bouncemasters.png' },
            { id: 7, t: 'Q29va2llIENsaWNrZXI=', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL0Nvb2tpZSUyMENsaWNrZXIuaHRtbA==', c: 'd97706', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Cookie%20Clicker.png' },
            { id: 8, t: 'Q29yZWJhbGw=', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL0NvcmViYWxsLmh0bWw=', c: 'f87171', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Coreball.png' },
            { id: 9, t: 'Q3Jvc3N5IFJvYWQ=', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL0Nyb3NzeSUyMFJvYWQuaHRtbA==', c: '10b981', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Crossy%20Road.png' },
            { id: 10, t: 'RHJpdmUgTWFk', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL0RyaXZlJTIwTWFkLmh0bWw=', c: '34d399', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Drive%20Mad.png' },
            { id: 11, t: 'RWdnaSBSYXIg', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL2VnZ3ljYXIv', c: 'facc15', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Eggy%20Car.png' },
            { id: 12, t: 'RmxhcHB5IEJpcmQ=', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL0ZsYXBweSUyMEJpcmQuaHRtbA==', c: 'facc15', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Flappy%20Bird.png' },
            { id: 13, t: 'RnJpZGF5IE5pZ2h0IEZ1bmtpbg==', u: '', c: 'ef4444', y: LOAD_FNF_VARIANT, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Friday%20Night%20Funkin.png' },
            { id: 14, t: 'R2VvbWV0cnkgRGFzaCBMaXRl', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL0dlb21ldHJ5JTIwRGFzaCUyMExpdGUuaHRtbA==', c: '3b82f6', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Geometry%20Dash%20Lite.png' },
            { id: 15, t: 'UG9seSBUcmFjaw==', u: 'aHR0cHM6Ly9odG1sLWNsYXNzaWMuaXRjaC56b25lL2h0bWwvMTU0NTEzMzAvaW5kZXguaHRtbA==', c: 'ef4444', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Poly%20Track.png' },
            { id: 16, t: 'UmFnZG9sbCBBcmNoZXJz', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL1JhZ2RvbGwlMjBBcmNoZXJzLmh0bWw=', c: 'ef4444', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Ragdoll%20Archers.png' },
            { id: 17, t: 'U2FuZGJveGVscw==', u: 'aHR0cHM6Ly9zaGFsYml0by52ZXJjZWwuYXBwLw==', c: 'ef4444', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Sandboxels.png' },
            { id: 18, t: 'U3RpY2ttYW4gSG9vaw==', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL1N0aWNrbWFuJTIwSG9vay5odG1s', c: '10b981', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Stickman%20Hook.png' },
            { id: 20, t: 'VGlueSBGaXNoaW5n', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL1RpbnklMjBGaXNoaW5nLmh0bWw=', c: 'facc15', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Tiny%20Fishing.png' },
            { id: 23, t: 'Q3JpY2tldA==', u: 'aHR0cHM6Ly9kb29kbGVjcmlja2V0LnBhZ2VzLmRldi9nb29nbGUtY3JpY2tldC8=', c: 'f97316', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Cricket.png' },
            { id: 24, t: 'Rmx1aWQgU2ltdWxhdGlvbg==', u: 'aHR0cHM6Ly9oYXhpb21pYy5naXRodWIuaW8vcHJvamVjdHMvd2ViZ2wtZmx1aWQtYW5kLXBhcnRpY2xlcy8=', c: '3b82f6', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Fluid%20Simulation.png' },
            { id: 26, t: 'QmFzZWJhbGw=', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL0dvb2dsZSUyMEJhc2ViYWxsLmh0bWw=', c: '10b981', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Baseball.png' },
            { id: 27, t: 'SSBGb2FYSjBlU0JFYjJ4c1lYSWdWMlZpYzJsMFpRPT0=', u: 'aHR0cHM6Ly9rbGVlZGVyLmRlL2ZpbGVzL21vYWkyLyVGMCU5RiU5NyVCZi5odG1s', c: '34d399', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Thirty%20Dollar%20Website.png' },
            { id: 28, t: 'Q2hhdEdQVA==', u: 'aHR0cHM6Ly93d3cuaG90Ym90LmNvbS9mcmVlLWNoYXRncHQ=', c: '16a34a', y: LOAD_ASSET, g: APP_CATEGORY, i: 'https://notbingsa.github.io/Zenith/apps/images/ChatGPT.png' },
            { id: 29, t: 'RnJ1aXQgTmluamE=', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL0ZydWl0JTIwTmluamEuaHRtbA==', c: '10b981', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Fruit%20Ninja.png' },
            { id: 30, t: 'U3Vydml2YWwgUmFjZQ==', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL2Nsc3Vydml2YWxyYWNldjIuaHRtbA==', c: '7c3aed', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Survival%20Race.png' },
            { id: 31, t: 'WW9ob2hvLmlv', u: 'aHR0cHM6Ly9uZWJ1bGFnYW1lcy51cy9zdG9yYWdlL3lvaG9oby8=', c: '2563eb', y: LOAD_ASSET, g: GAME_CATEGORY, i: 'https://notbingsa.github.io/Zenith/games/images/Yohoho.io.png' },
        ];
        function createAssetCardHtml(asset, sizeClass = 'w-full h-auto aspect-square') {
            const title = decodeTitle(asset);
            const type = asset.y;
            let clickHandler;
            if (type === LOAD_FNF_VARIANT) {
                clickHandler = `executeVariant(${asset.id})`;
            } else {
                clickHandler = `processMatrix(${asset.id})`;
            }
            const placeholderSize = '300x300';
            const imageSrc = asset.i;
            const placeholderText = title.replace(/\s/g, '+');
            return `
                <a href="?id=${asset.id}" onclick="${clickHandler}; return false;" class="block bg-gray-800 rounded-xl overflow-hidden asset-card-shadow ${sizeClass} group relative" data-category="${asset.g}">
                    <img src="${imageSrc}" 
                         onerror="this.onerror=null;this.src='https://placehold.co/${placeholderSize}/${asset.c}/ffffff?text=${placeholderText}'" 
                         class="w-full h-full object-cover transition duration-300 group-hover:scale-105" />
                    <div class="absolute inset-0 bg-black/30 flex items-end justify-center p-2 opacity-0 transition-opacity duration-200 group-hover:opacity-100">
                        <span class="text-sm font-semibold text-white text-center">${title}</span>
                    </div>
                </a>
            `;
        }
        function renderAllAssets() {
            const assetList = document.getElementById('game-list');
            if (assetList) {
                const allAssetsHtml = ALL_ASSETS.map(asset => createAssetCardHtml(asset)).join('');
                assetList.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 lg:gap-6 transition-opacity duration-150';
                assetList.style.opacity = 0;
                setTimeout(() => {
                    assetList.innerHTML = allAssetsHtml;
                    assetList.style.opacity = 1;
                }, 150);
            }
        }
        function renderRandomAssets() {
            const getRandomAssets = (count) => {
                const assetOnlyList = ALL_ASSETS.filter(g => g.g === GAME_CATEGORY);
                const shuffled = [...assetOnlyList].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            }
            const randomAssets = getRandomAssets(5);
            const randomAssetsHtml = randomAssets.map(asset => createAssetCardHtml(asset)).join('');
            const randomAssetsContainer = document.getElementById('random-assets-section');
            if (randomAssetsContainer) {
                randomAssetsContainer.innerHTML = `
                    <h3 class="section-heading-glow text-xl md:text-2xl font-semibold mb-6 text-center pt-8 text-white">
                        <i class="fas fa-dice text-zenith-purple mr-2"></i>${RANDOM_PICKS}
                    </h3>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 lg:gap-6 mb-12">
                        ${randomAssetsHtml}
                    </div>
                `;
            }
        }
        function applySearch() {
            const searchInput = document.getElementById('game-search');
            const searchQuery = (searchInput && searchInput.value || '').toLowerCase();
            const cards = document.querySelectorAll('#game-list a, #random-assets-section a');
            cards.forEach(card => {
                const titleElement = card.querySelector('span');
                const title = titleElement ? titleElement.textContent : '';
                if (title.toLowerCase().includes(searchQuery)) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
        }
        function getAssetIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            return id ? parseInt(id, 10) : null;
        }
        function processMatrix(assetId) {
            const asset = ALL_ASSETS.find(a => a.id === assetId);
            if (!asset) {
                console.error('Asset not found for ID:', assetId);
                return;
            }
            try {
                history.pushState(null, decodeTitle(asset), `?id=${assetId}`);
            } catch (e) {
                console.error("History update failed in iframe, continuing normally.");
            }
            processMatrixInternal(asset);
        }
        function executeVariant(assetId) {
            const asset = ALL_ASSETS.find(a => a.id === assetId);
            if (!asset) return console.error('Asset not found for ID:', assetId);
            const title = decodeTitle(asset);
            try {
                history.pushState(null, title, `?id=${assetId}`);
            } catch (e) {
                console.error("History update failed in iframe, continuing normally.");
            }
            const userAgent = navigator.userAgent;
            const isMobileDevice = /Mobi|Android|iPhone|iPod|iPad/i.test(userAgent);
            const isSafariBrowser = userAgent.includes('Safari') && !userAgent.includes('Chrome');
            const loadMobileVersion = isMobileDevice || isSafariBrowser;
            let url;
            const desktopUrl = 'https://html-classic.itch.zone/html/2876359-1383886/index.html';
            const mobileUrl = 'https://html-classic.itch.zone/html/4459499/luckydog7.github.io-master/funkinmobile/game/index.html';
            if (loadMobileVersion) {
                url = mobileUrl;
            } else {
                url = desktopUrl;
            }
            const tempAsset = { ...asset, u: url };
            processMatrixInternal(tempAsset);
        }
        function processMatrixInternal(asset) {
            const assetId = asset.id;
            const title = decodeTitle(asset);
            const url = asset.u;
            if (!url) {
                console.error('Asset URL is empty for ID:', assetId, 'Cannot load.');
                return;
            }
            const isFixedSize = title === ADFOAI_TITLE;
            let targetWidth = '100%';
            let targetHeight = '100%';
            if (isFixedSize) {
                targetWidth = ADFOAI_WIDTH;
                targetHeight = ADFOAI_HEIGHT;
            }
            if (labelRegistry) labelRegistry.textContent = title;
            if (mainPanel) {
                mainPanel.classList.add('hidden');
            }
            const secretContent = document.getElementById('secret-mode-content');
            if (secretContent) {
                secretContent.classList.add('hidden');
            }
            if (renderTarget) {
                renderTarget.className = 'relative w-full h-[80vh] mx-auto md:max-w-5xl rounded-2xl overflow-hidden shadow-2xl transition-all duration-300';
                renderTarget.style.height = 'calc(100vh - 100px)';
                renderTarget.innerHTML = '';
                renderTarget.classList.remove('hidden');
            } else {
                return;
            }
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'loading-overlay';
            loadingOverlay.className = 'absolute inset-0 bg-zenith-dark/95 flex flex-col items-center justify-center p-8 z-30 rounded-2xl transition-opacity duration-500';
            loadingOverlay.innerHTML = `
                <div class="rounded-spinner mb-4"></div>
                <h3 class="text-xl font-semibold mb-1 text-white">Loading:</h3>
                <p class="text-2xl font-bold text-zenith-purple text-center">${title}</p>
                <div class="mt-4 w-48 h-2 bg-gray-700 rounded-full overflow-hidden">
                    <div id="loading-bar" class="h-full bg-zenith-purple transition-all duration-300" style="width: 0%"></div>
                </div>
            `;
            const loadingBar = loadingOverlay.querySelector('#loading-bar');
            let progress = 0;
            const iframe = document.createElement('iframe');
            iframe.id = 'asset-iframe';

            const interval = setInterval(() => {
                if (progress < 70) {
                    progress += 10;
                    if (loadingBar) loadingBar.style.width = `${progress}%`;
                } else {
                    clearInterval(interval);
                    iframe.src = url;
                }
            }, 50);

            const controlBar = document.createElement('div');
            controlBar.className = 'asset-control-bar';
            const displayToggleButton = document.createElement('button');
            displayToggleButton.id = 'fullscreen-toggle-button';
            displayToggleButton.className = 'fullscreen-button';
            displayToggleButton.innerHTML = '<i id="fs-icon" class="fas fa-expand"></i>';
            displayToggleButton.onclick = () => adjustCanvasGeometry(renderTarget);
            controlBar.appendChild(displayToggleButton);

            // Start with base CSS class
            iframe.className = 'border-none opacity-0 transition-opacity duration-500';
            if (isFixedSize) {
                iframe.style.width = targetWidth;
                iframe.style.height = targetHeight;
                iframe.style.display = 'block';
            } else {
                iframe.className += ' w-full h-full';
            }
            iframe.setAttribute('allow', 'fullscreen');
            iframe.setAttribute('allowfullscreen', 'true');
            iframe.setAttribute('loading', 'lazy');
            const centeringWrapper = document.createElement('div');
            centeringWrapper.className = 'asset-iframe-content';
            centeringWrapper.appendChild(iframe);
            renderTarget.appendChild(controlBar);
            renderTarget.appendChild(centeringWrapper);
            renderTarget.appendChild(loadingOverlay);
            iframe.onload = () => {
                clearInterval(interval);
                if (loadingBar) loadingBar.style.width = '100%';
                loadingOverlay.style.opacity = '0';
                iframe.classList.remove('opacity-0');
                setTimeout(() => {
                    loadingOverlay.remove();
                }, 500);
            };

            iframe.onerror = () => {
                console.error("Iframe failed to load");
                loadingOverlay.remove();
            };

            // Safety timeout: Remove overlay after 15 seconds (extended)
            setTimeout(() => {
                if (document.body.contains(loadingOverlay)) {
                    console.warn("Loading timeout reached, forcing overlay removal.");
                    loadingOverlay.style.opacity = '0';
                    iframe.classList.remove('opacity-0');
                    setTimeout(() => loadingOverlay.remove(), 500);
                }
            }, 15000);

            // Skip Loading Button (appears after 5 seconds)
            setTimeout(() => {
                if (document.body.contains(loadingOverlay)) {
                    const skipButton = document.createElement('button');
                    skipButton.className = 'mt-6 px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors duration-200 shadow-lg border border-gray-500';
                    skipButton.innerHTML = '<i class="fas fa-forward mr-2"></i>Skip Loading';
                    skipButton.onclick = () => {
                        console.log("User skipped loading.");
                        loadingOverlay.style.opacity = '0';
                        iframe.classList.remove('opacity-0');
                        setTimeout(() => loadingOverlay.remove(), 500);
                    };
                    loadingOverlay.appendChild(skipButton);
                }
            }, 5000);
        }
        function adjustCanvasGeometry(container) {
            const isFullView = container.classList.toggle('full-view');
            const fsButton = document.getElementById('fullscreen-toggle-button');
            if (isFullView) {
                fsButton.innerHTML = '<i class="fas fa-compress"></i>';
            } else {
                fsButton.innerHTML = '<i class="fas fa-expand"></i>';
            }
        }
        function resetViewport() {
            try {
                history.pushState(null, HOMEPAGE_TITLE, window.location.pathname);
            } catch (e) {
                console.error("History update failed in iframe, continuing normally.");
            }
            if (labelRegistry) labelRegistry.textContent = HOMEPAGE_TITLE;
            if (mainPanel) mainPanel.classList.remove('hidden');
            const secretContent = document.getElementById('secret-mode-content');
            if (secretContent) {
                secretContent.classList.add('hidden');
                document.getElementById('tester-catalog-grid-wrapper').classList.add('hidden');
                document.getElementById('testAllGamesButton').textContent = 'Test All Games';
                document.getElementById('game-cards-container').innerHTML = '';
            }
            if (renderTarget) renderTarget.innerHTML = '';
            if (renderTarget) renderTarget.className = 'hidden relative';
            const overlay = document.getElementById('loading-overlay');
            if (overlay) overlay.remove();
            if (document.fullscreenElement) {
                document.exitFullscreen().catch(() => { });
            }
        }
        function toggleSecretModal(show) {
            const modal = document.getElementById('secret-modal');
            const input = document.getElementById('secret-input');
            const message = document.getElementById('secret-message');
            if (show) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                input.value = '';
                message.classList.add('hidden');
                input.onkeydown = (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        checkSecretCode();
                    }
                };
                setTimeout(() => input.focus(), 100);
            } else {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                input.onkeydown = null;
            }
        }
        function checkSecretCode() {
            const input = document.getElementById('secret-input');
            const message = document.getElementById('secret-message');
            const code = input.value.trim();
            if (code === SECRET_CODE) {
                applySecretMode(true);
                toggleSecretModal(false);
            } else {
                message.textContent = "Invalid key. Access denied.";
                message.classList.remove('hidden');
                input.value = '';
                input.focus();
            }
        }
        function applySecretMode(activate) {
            const homepage = document.getElementById('homepage-section');
            const assetContainer = document.getElementById('asset-container');
            const secretContent = document.getElementById('secret-mode-content');
            const headerTitle = document.getElementById('header-title');
            const secretToggle = document.getElementById('secret-mode-toggle');
            const primaryMarker = document.getElementById('main-zenith-title');
            const taglineElement = document.getElementById('random-tagline');
            if (activate) {
                homepage.classList.add('hidden');
                assetContainer.classList.add('hidden');
                secretContent.classList.remove('hidden');
                headerTitle.textContent = 'Tester';
                primaryMarker.textContent = 'Tester';
                taglineElement.textContent = 'Test Everything.';
                secretToggle.innerHTML = '<i class="fas fa-lock-open"></i>';
                secretToggle.classList.remove('hover:bg-zenith-purple/50');
                secretToggle.classList.add('text-zenith-purple');
                window.scrollTo(0, 0);
            } else {
                homepage.classList.remove('hidden');
                secretContent.classList.add('hidden');
                if (labelRegistry) labelRegistry.textContent = HOMEPAGE_TITLE;
                if (primaryMarker) primaryMarker.textContent = ZENITH_TITLE;
                secretToggle.innerHTML = '<i class="fas fa-lock"></i>';
                secretToggle.classList.add('hover:bg-zenith-purple/50');
                secretToggle.classList.remove('text-zenith-purple');
                resetViewport();
            }
        }
        function handleTesterAssetLoad() {
            testerLoadCount++;
            const progressBar = document.getElementById('tester-loading-bar');
            const statusText = document.getElementById('tester-loading-status');
            const progress = (testerLoadCount / testerTotalAssets) * 100;
            if (progressBar) progressBar.style.width = `${progress.toFixed(0)}%`;
            if (statusText) statusText.textContent = `Loading Assets (${testerLoadCount} / ${testerTotalAssets})`;
            if (testerLoadCount >= testerTotalAssets) {
                const banner = document.getElementById('tester-loading-banner');
                if (banner) {
                    banner.classList.remove('bg-indigo-900/90');
                    banner.classList.add('bg-green-700/90');
                    statusText.textContent = `All ${testerTotalAssets} Assets Loaded!`;
                    setTimeout(() => {
                        banner.classList.add('opacity-0');
                        setTimeout(() => {
                            banner.classList.add('hidden');
                            document.querySelectorAll('#game-cards-container iframe').forEach(iframe => {
                                iframe.classList.remove('opacity-30');
                            });
                        }, 300);
                    }, 500);
                }
            }
        }
        function createTesterIframe(title, url, category, color) {
            const safeTitle = title.replace(/'/g, "\\'");
            const safeUrl = url.replace(/'/g, "\\'");
            return `
                <div class="bg-gray-800 rounded-xl overflow-hidden shadow-2xl relative border border-zenith-purple/50 aspect-video group">
                    <div class="absolute top-0 left-0 right-0 bg-black/70 p-1 flex justify-between items-center z-20">
                        <span class="text-xs font-semibold text-white truncate px-1">${title}</span>
                        <span class="text-xs font-medium text-zenith-blue bg-blue-900/70 px-1.5 py-0.5 rounded-full">${category}</span>
                    </div>
                    <iframe 
                        data-src="${url}"
                        class="tester-iframe absolute inset-0 w-full h-full border-none opacity-30 transition-opacity duration-500"
                        onload="handleTesterAssetLoad()"
                        loading="lazy"
                        sandbox="allow-scripts allow-same-origin allow-popups allow-forms"
                        allowfullscreen="true">
                    </iframe>
                    <button onclick="launchTesterAsset('${safeUrl}', '${safeTitle}', '${color}')" 
                            class="absolute bottom-2 right-2 p-1.5 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition duration-300 z-30 hover:bg-zenith-purple/70">
                        <i class="fas fa-expand text-sm"></i>
                    </button>
                </div>
            `;
        }
        function generateTesterCatalog() {
            testerAssetList = [];
            const desktopUrl = 'https://html-classic.itch.zone/html/2876359-1383886/index.html';
            const mobileUrl = 'https://html-classic.itch.zone/html/4459499/luckydog7.github.io-master/funkinmobile/game/index.html';
            for (const asset of ALL_ASSETS) {
                const decodedTitle = decodeTitle(asset);
                if (asset.y === LOAD_FNF_VARIANT) {
                    const fnfTitle = decodedTitle;
                    testerAssetList.push({ t: `${fnfTitle} (Desktop)`, u: desktopUrl, g: asset.g, c: asset.c, i: asset.i });
                    testerAssetList.push({ t: `${fnfTitle} (Mobile)`, u: mobileUrl, g: asset.g, c: asset.c, i: asset.i });
                } else {
                    testerAssetList.push({ ...asset, t: decodedTitle });
                }
            }
            testerTotalAssets = testerAssetList.length;
            const cardsHtml = testerAssetList.map(asset => {
                return createTesterIframe(asset.t, asset.u, asset.g, asset.c);
            }).join('');
            return cardsHtml;
        }
        function loadAllTesterIframes() {
            const iframes = document.querySelectorAll('#game-cards-container .tester-iframe');
            iframes.forEach((iframe, index) => {
                const asset = testerAssetList[index];
                if (asset) {
                    iframe.src = iframe.getAttribute('data-src');
                }
            });
        }
        function toggleTesterCatalog() {
            const gridWrapper = document.getElementById('tester-catalog-grid-wrapper');
            const button = document.getElementById('testAllGamesButton');
            const container = document.getElementById('game-cards-container');
            const banner = document.getElementById('tester-loading-banner');
            if (gridWrapper.classList.contains('hidden')) {
                testerLoadCount = 0;
                container.innerHTML = generateTesterCatalog();
                banner.classList.remove('hidden', 'opacity-0', 'bg-green-700/90');
                banner.classList.add('bg-indigo-900/90');
                document.getElementById('tester-loading-bar').style.width = '0%';
                document.getElementById('tester-loading-status').textContent = `Loading Assets (0 / ${testerTotalAssets})`;
                gridWrapper.classList.remove('hidden');
                button.textContent = 'Hide Live Grid';
                setTimeout(loadAllTesterIframes, 100);
            } else {
                gridWrapper.classList.add('hidden');
                button.textContent = 'Test All Games';
                container.innerHTML = '';
                banner.classList.add('hidden');
            }
        }
        function launchTesterAsset(url, title, color) {
            const secretContent = document.getElementById('secret-mode-content');
            if (secretContent) {
                secretContent.classList.add('hidden');
            }
            if (labelRegistry) labelRegistry.textContent = title;
            if (renderTarget) {
                renderTarget.className = 'relative w-full h-[80vh] mx-auto md:max-w-5xl rounded-2xl overflow-hidden shadow-2xl transition-all duration-300';
                renderTarget.style.height = 'calc(100vh - 100px)';
                renderTarget.innerHTML = '';
                renderTarget.classList.remove('hidden');
            } else {
                return;
            }
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'loading-overlay';
            loadingOverlay.className = 'absolute inset-0 bg-zenith-dark/95 flex flex-col items-center justify-center p-8 z-30 rounded-2xl transition-opacity duration-500';
            loadingOverlay.innerHTML = `
                <div class="rounded-spinner mb-4"></div>
                <h3 class="text-xl font-semibold mb-1 text-white">Loading Test:</h3>
                <p class="text-2xl font-bold text-zenith-purple text-center">${title}</p>
                <div class="mt-4 w-48 h-2 bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-zenith-purple w-full"></div>
                </div>
            `;
            const controlBar = document.createElement('div');
            controlBar.className = 'asset-control-bar';
            const backButton = document.createElement('button');
            backButton.className = 'fullscreen-button';
            backButton.innerHTML = '<i class="fas fa-arrow-left"></i>';
            backButton.onclick = () => {
                resetViewport();
                applySecretMode(true);
            };
            controlBar.appendChild(backButton);
            const displayToggleButton = document.createElement('button');
            displayToggleButton.id = 'fullscreen-toggle-button';
            displayToggleButton.className = 'fullscreen-button';
            displayToggleButton.innerHTML = '<i id="fs-icon" class="fas fa-expand"></i>';
            displayToggleButton.onclick = () => adjustCanvasGeometry(renderTarget);
            controlBar.appendChild(displayToggleButton);
            const iframe = document.createElement('iframe');
            iframe.id = 'asset-iframe';
            iframe.className = 'border-none opacity-0 transition-opacity duration-500 w-full h-full';
            iframe.setAttribute('allow', 'fullscreen');
            iframe.setAttribute('allowfullscreen', 'true');
            iframe.setAttribute('loading', 'lazy');
            iframe.src = url;
            const centeringWrapper = document.createElement('div');
            centeringWrapper.className = 'asset-iframe-content';
            centeringWrapper.appendChild(iframe);
            renderTarget.appendChild(controlBar);
            renderTarget.appendChild(centeringWrapper);
            renderTarget.appendChild(loadingOverlay);
            iframe.onload = () => {
                loadingOverlay.style.opacity = '0';
                iframe.classList.remove('opacity-0');
                setTimeout(() => {
                    loadingOverlay.remove();
                }, 500);
            };

            // Skip Loading Button for Tester Asset (appears after 5 seconds)
            setTimeout(() => {
                if (renderTarget.contains(loadingOverlay)) {
                    const skipButton = document.createElement('button');
                    skipButton.className = 'mt-6 px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors duration-200 shadow-lg border border-gray-500';
                    skipButton.innerHTML = '<i class="fas fa-forward mr-2"></i>Skip Loading';
                    skipButton.onclick = () => {
                        console.log("User skipped loading (Tester).");
                        loadingOverlay.style.opacity = '0';
                        iframe.classList.remove('opacity-0');
                        setTimeout(() => loadingOverlay.remove(), 500);
                    };
                    loadingOverlay.appendChild(skipButton);
                }
            }, 5000);
        }
        window.addEventListener('popstate', (event) => {
            const assetId = getAssetIdFromUrl();
            if (assetId) {
                const asset = ALL_ASSETS.find(a => a.id === assetId);
                if (asset) {
                    if (asset.y === LOAD_FNF_VARIANT) {
                        executeVariant(assetId);
                    } else {
                        processMatrix(assetId);
                    }
                } else {
                    try {
                        history.replaceState(null, '', window.location.pathname);
                    } catch (e) {
                        console.error("History replace failed on invalid ID, continuing normally.");
                    }
                    resetViewport();
                }
            } else {
                resetViewport();
            }
        });
        document.addEventListener('DOMContentLoaded', () => {
            mainPanel = document.getElementById('homepage-section');
            renderTarget = document.getElementById('asset-container');
            labelRegistry = document.getElementById('header-title');
            primaryMarker = document.getElementById('main-zenith-title');
            ALL_ASSETS.sort((a, b) => {
                const titleA = decodeTitle(a).toLowerCase();
                const titleB = decodeTitle(b).toLowerCase();
                if (titleA < titleB) return -1;
                if (titleA > titleB) return 1;
                return 0;
            });
            const assetIdFromUrl = getAssetIdFromUrl();
            if (assetIdFromUrl) {
                const asset = ALL_ASSETS.find(a => a.id === assetIdFromUrl);
                if (asset) {
                    if (asset.y === LOAD_FNF_VARIANT) {
                        executeVariant(assetIdFromUrl);
                    } else {
                        processMatrix(assetIdFromUrl);
                    }
                } else {
                    try {
                        history.replaceState(null, '', window.location.pathname);
                    } catch (e) {
                        console.error("History replace failed on invalid ID, continuing normally.");
                    }
                    loadHomePage();
                }
            } else {
                loadHomePage();
            }
            function loadHomePage() {
                const searchInput = document.getElementById('game-search');
                if (searchInput) {
                    searchInput.placeholder = 'Search assets...';
                }
                document.title = ZENITH_TITLE + ' - ' + TITLE_SUFFIX;
                if (labelRegistry) labelRegistry.textContent = HOMEPAGE_TITLE;
                if (primaryMarker) primaryMarker.textContent = ZENITH_TITLE;
                const taglineElement = document.getElementById('random-tagline');
                if (taglineElement) {
                    const randomIndex = Math.floor(Math.random() * TAGLINES.length);
                    taglineElement.textContent = TAGLINES[randomIndex];
                }
                const splashLoader = document.getElementById('website-splash-loader');
                if (splashLoader) {
                    splashLoader.style.opacity = '0';
                    setTimeout(() => {
                        splashLoader.style.display = 'none';
                    }, 300);
                }
                renderRandomAssets();
                renderAllAssets();
            }
        });
    </script>
</head>

<body class="font-sans dark-gradient-bg text-gray-100">
    <div id="website-splash-loader"
        class="fixed inset-0 z-[10000] bg-zenith-dark flex flex-col items-center justify-center transition-opacity duration-300">
        <img src="https://notbingsa.github.io/Zenith/ui/logo.png" alt="Zenith Logo"
            class="w-16 h-16 mb-4 animate-pulse object-contain" />
        <h2 id="splash-title" class="text-3xl font-extrabold zenith-title-glow tracking-tighter">Zenith</h2>
        <p class="text-sm text-gray-400 mt-2">Loading interface...</p>
    </div>
    <div id="secret-modal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-[1000] p-4"
        onclick="if(event.target.id === 'secret-modal') toggleSecretModal(false)">
        <div
            class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-sm border border-zenith-purple/50 transform scale-100 transition-transform duration-300">
            <h3 class="text-2xl font-bold text-white mb-6 text-center">Enter Code</h3>
            <input type="password" id="secret-input" value=""
                class="w-full py-3 px-4 pl-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-zenith-blue mb-4" />
            <p id="secret-message" class="text-sm text-red-400 mb-4 hidden"></p>
            <div class="flex justify-between space-x-3">
                <button onclick="toggleSecretModal(false)"
                    class="flex-1 py-2 rounded-lg bg-gray-600 text-white font-semibold hover:bg-gray-700 transition duration-150">
                    Cancel
                </button>
                <button onclick="checkSecretCode()"
                    class="flex-1 py-2 rounded-lg bg-zenith-purple text-white font-semibold hover:bg-zenith-purple/90 transition duration-150">
                    Unlock
                </button>
            </div>
        </div>
    </div>
    <header
        class="py-3 px-4 md:px-8 flex items-center justify-between fixed top-0 left-0 right-0 z-50 bg-black/30 backdrop-blur-sm">
        <a href="./" class="flex items-center space-x-3" onclick="applySecretMode(false); return false;">
            <img src="https://notbingsa.github.io/Zenith/ui/logo.png" alt="Zenith Logo"
                class="w-10 h-10 object-contain" />
            <h1 id="header-title" class="text-xl md:text-3xl font-bold"></h1>
        </a>
        <button id="secret-mode-toggle"
            class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-zenith-purple/50 transition duration-200"
            onclick="toggleSecretModal(true)">
            <i class="fas fa-lock"></i>
        </button>
    </header>
    <main class="pt-24 md:pt-32 pb-8 px-4 md:px-8 max-w-7xl mx-auto">
        <div id="secret-mode-content" class="hidden text-center py-10 rounded-xl">
            <h2 class="text-4xl font-extrabold text-blue-400 mb-6">Tester Mode</h2>
            <p class="text-lg text-gray-400 mb-8">Click below to load the live asset testing grid.</p>
            <button id="testAllGamesButton"
                class="px-8 py-3 text-lg font-semibold text-white rounded-xl shadow-lg bg-zenith-purple hover:bg-zenith-blue transition duration-200"
                onclick="toggleTesterCatalog();">
                Test All Games
            </button>
            <div id="tester-catalog-grid-wrapper" class="hidden mt-12 w-full mx-auto relative">
                <h3 class="text-2xl font-bold text-gray-200 mb-6 border-b border-gray-700 pb-3">Live Test Grid</h3>
                <div id="tester-loading-banner"
                    class="fixed inset-x-0 mx-auto w-full max-w-7xl top-24 md:top-32 p-4 bg-indigo-900/90 border border-indigo-700 rounded-xl shadow-2xl transition-opacity duration-300 z-45 hidden">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-sync-alt w-5 h-5 text-indigo-400 animate-spin"></i>
                        <span id="tester-loading-status" class="text-lg font-semibold text-white">
                            Initializing...
                        </span>
                    </div>
                    <div class="mt-3 w-full bg-indigo-200 rounded-full h-2.5">
                        <div id="tester-loading-bar"
                            class="bg-indigo-400 h-2.5 rounded-full transition-all duration-500" style="width: 0%">
                        </div>
                    </div>
                </div>
                <div id="game-cards-container"
                    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                </div>
            </div>
        </div>
        <div id="homepage-section">
            <section class="text-center py-16">
                <h2 id="main-zenith-title"
                    class="text-6xl md:text-8xl font-extrabold zenith-title-glow tracking-tighter mb-4"></h2>
                <p id="random-tagline" class="text-xl md:text-2xl font-medium text-white mb-4"
                    style="text-shadow: 0 0 10px #3b82f6;"></p>
                <div class="w-full h-0.5 bg-gradient-to-r from-transparent via-zenith-purple/50 to-transparent mb-0">
                </div>
            </section>
            <div id="random-assets-section" class="mb-4">
            </div>
            <section class="text-center">
                <div class="mb-10 w-full max-w-xl mx-auto relative flex items-center pt-8">
                    <input type="text" id="game-search" placeholder=""
                        class="w-full p-3 pl-12 bg-gray-700/50 border border-zenith-purple/50 rounded-lg text-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-zenith-purple"
                        oninput="applySearch()" />
                    <svg class="absolute left-4 w-5 h-5 text-gray-400" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-4.35-4.35M17 11a6 6 0 11-12 0 6 6 0 0112 0z"></path>
                    </svg>
                </div>
                <div id="game-list"
                    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 lg:gap-6 transition-opacity duration-150">
                </div>
            </section>
        </div>
        <div id="asset-container" class="hidden relative"></div>
    </main>
</body>

</html>
