<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenith</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Exo 2"', 'sans-serif'],
                    },
                    colors: {
                        'zenith-dark': '#0c0a09',
                        'zenith-blue': '#3b82f6',
                        'zenith-purple': '#7c3aed',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Exo 2', sans-serif;
        }

        .dark-gradient-bg {
            background: linear-gradient(180deg, #111827 0%, #0c0a09 100%);
            min-height: 10vh;
        }

        .zenith-title-glow {
            background-image: linear-gradient(to right, #7c3aed, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            color: #ffffff;
        }

        .section-heading-glow {
            color: #d1d5db;
        }

        .asset-card-shadow {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3), 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .asset-card-shadow:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.5), 0 6px 10px rgba(0, 0, 0, 0.2);
        }

        .fullscreen-button {
            position: relative;
            background-color: rgba(107, 114, 128, 0.9);
            color: white;
            padding: 0;
            height: 40px;
            width: 40px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: none;
            margin-left: 10px;
        }

        .fullscreen-button:hover {
            background-color: rgba(107, 114, 128, 1);
        }

        .asset-control-bar {
            position: absolute;
            top: auto;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            z-index: 40;
            background-color: #1f2937;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 10px;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.4);
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1rem;
        }

        .asset-iframe-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 50px;
            background-color: black;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #loading-overlay {
            border-radius: 1rem;
        }

        .rounded-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #7c3aed;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .full-view {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
            border-radius: 0 !important;
            max-width: none !important;
            box-shadow: none !important;
        }

        .full-view .asset-control-bar {
            border-radius: 0 !important;
        }

        #tester-loading-banner {
            z-index: 45;
        }
    </style>
    <script>
        let mainPanel, renderTarget, labelRegistry, primaryMarker;
        let testerLoadCount = 0;
        let testerTotalAssets = 0;
        let testerAssetList = [];

        const BLOCKED_DOMAINS = [
            'exodragon.com',
            'https://exodragon.com/cp/'
        ];


        async function measureInternetSpeed() {
            try {
                const imageSize = 100000; // 100KB
                const startTime = performance.now();


                const cacheBuster = '&t=' + new Date().getTime();
                const response = await fetch('https://speed.cloudflare.com/__down?bytes=100000' + cacheBuster);
                await response.blob();

                const endTime = performance.now();
                const durationInSeconds = (endTime - startTime) / 1000;
                const speedBps = imageSize / durationInSeconds;
                const speedMbps = (speedBps * 8) / (1024 * 1024);

                return speedMbps;
            } catch (error) {
                console.error('Speed test failed:', error);
                return null;
            }
        }

        function showSlowInternetWarning(speedMbps) {
            const warningModal = document.createElement('div');
            warningModal.id = 'slow-internet-warning';
            warningModal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-[1001] p-4';
            warningModal.onclick = (e) => {
                if (e.target.id === 'slow-internet-warning') closeSpeedWarning();
            };

            const speedDisplay = speedMbps ? speedMbps.toFixed(2) : 'Unknown';

            warningModal.innerHTML = `
                <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md border border-yellow-500/50 transform scale-100 transition-transform duration-300">
                    <div class="flex items-center justify-center mb-4">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-5xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-4 text-center">Slow Internet Detected</h3>
                    <p class="text-gray-300 mb-4 text-center">
                        Your current internet speed is approximately <span class="text-yellow-500 font-bold">${speedDisplay} Mbps</span>.
                    </p>
                    <p class="text-gray-400 mb-6 text-center text-sm">
                        Some games and apps may load slowly or not work properly. For the best experience, we recommend a connection of at least ${5} Mbps.
                    </p>
                    <div class="flex justify-center">
                        <button onclick="closeSpeedWarning()" 
                                class="px-6 py-3 rounded-lg bg-yellow-500 text-gray-900 font-semibold hover:bg-yellow-400 transition duration-150">
                            I Understand
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(warningModal);
        }

        function closeSpeedWarning() {
            const warningModal = document.getElementById('slow-internet-warning');
            if (warningModal) {
                warningModal.remove();
            }
        }

        function removeInfoSplash() {
            const splashLoader = document.getElementById('website-splash-loader');
            if (splashLoader && window.getComputedStyle(splashLoader).display !== 'none') {
                splashLoader.style.opacity = '0';
                setTimeout(() => {
                    splashLoader.style.display = 'none';
                }, 300);
            }
        }

        async function checkInternetSpeed() {
            // Check if warning was already shown this session
            if (sessionStorage.getItem('zenith_speed_warning_shown')) {
                return;
            }

            const speedMbps = await measureInternetSpeed();

            if (speedMbps !== null && speedMbps < 5) {
                showSlowInternetWarning(speedMbps);
                sessionStorage.setItem('zenith_speed_warning_shown', 'true');
            }
        }

        function testBadInternet() {

            sessionStorage.removeItem('zenith_speed_warning_shown');
            showSlowInternetWarning(2.5);
            sessionStorage.setItem('zenith_speed_warning_shown', 'true');
        }

        function showLegalDisclaimer() {
            const disclaimerModal = document.createElement('div');
            disclaimerModal.id = 'legal-disclaimer';
            disclaimerModal.className = 'fixed inset-0 bg-black/95 flex items-center justify-center z-[10002] p-4 text-center backdrop-blur-sm';

            disclaimerModal.innerHTML = `
                <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-2xl border-2 border-red-600/50 transform scale-100 transition-transform duration-300">
                    <div class="flex justify-center mb-6">
                         <i class="fas fa-gavel text-red-500 text-5xl"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-white mb-6 tracking-tight">Legal Disclaimer</h2>
                    <p class="text-gray-300 text-lg mb-8 leading-relaxed">
                        For legal purposes, we do not condone or take responsibility for any use of this website to interrupt education. 
                        <span class="text-white font-semibold">Zenith</span> has been made for use at home or with permission by the overseers of the school's ICT.
                    </p>
                    <button onclick="document.getElementById('legal-disclaimer').remove()" 
                            class="px-10 py-4 rounded-xl bg-red-600 text-white font-bold text-lg hover:bg-red-500 transition duration-200 shadow-lg hover:shadow-red-600/20 active:scale-95">
                        I Understand
                    </button>
                </div>
            `;
            document.body.appendChild(disclaimerModal);
        }

        function handleAssetImageError(img, title, src) {
            console.error(`DEVELOPER ERROR: Failed to load image for "${title}". URL: ${src}. This might be a 404 Not Found or a blocked resource.`);
            const placeholderSize = '300x300';
            const placeholderText = title.replace(/\s/g, '+');
            // User friendly fallback
            img.onerror = null; // Prevent infinite loop
            img.src = `https://placehold.co/${placeholderSize}/374151/ffffff?text=${placeholderText}`;
            // Visual cue for the user (optional, maybe a border?)
            img.style.border = '2px solid #ef4444';
        }


        const CLOUDFLARE_SPEED_URL = 'https://speed.cloudflare.com/__down?bytes=100000000';
        const FALLBACK_SPEED_URL = 'https://httpbin.org/bytes/50000000';

        async function measureCloudflareSpeed() {
            const modal = document.createElement('div');
            modal.id = 'speed-test-modal';
            modal.className = 'fixed inset-0 bg-black/90 flex items-center justify-center z-[2000] p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md border border-zenith-purple/50 flex flex-col items-center">
                    <h3 class="text-2xl font-bold text-white mb-6">Testing Connection Speed</h3>
                    <div class="w-full bg-gray-700 rounded-full h-4 mb-4 overflow-hidden">
                        <div id="st-progress" class="bg-zenith-purple h-full transition-all duration-200" style="width: 0%"></div>
                    </div>
                    <div class="text-4xl font-mono font-bold text-zenith-blue mb-2">
                        <span id="st-speed">0.00</span> <span class="text-lg text-gray-400">Mbps</span>
                    </div>
                    <p id="st-status" class="text-gray-400 text-sm mb-6">Initializing...</p>
                    <button id="st-cancel" class="px-6 py-2 rounded-lg bg-red-600 text-white font-semibold hover:bg-red-500 transition duration-150">
                        Cancel
                    </button>
                </div>
            `;
            document.body.appendChild(modal);

            const progressEl = modal.querySelector('#st-progress');
            const speedEl = modal.querySelector('#st-speed');
            const statusEl = modal.querySelector('#st-status');
            const cancelBtn = modal.querySelector('#st-cancel');

            const controller = new AbortController();
            const signal = controller.signal;

            cancelBtn.onclick = () => {
                controller.abort();
                modal.remove();
            };

            const runTest = async (url, isFallback = false) => {
                try {
                    if (isFallback) {
                        statusEl.textContent = "Primary failed, trying fallback...";
                    }

                    const startTime = performance.now();
                    const response = await fetch(url, { signal });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    if (!response.body) throw new Error('ReadableStream not supported');

                    const reader = response.body.getReader();
                    const contentLength = +response.headers.get('Content-Length') || (isFallback ? 50000000 : 100000000);

                    let receivedLength = 0;
                    let lastUpdate = startTime;

                    while (true) {
                        const { done, value } = await reader.read();

                        if (done) break;

                        receivedLength += value.length;
                        const currentTime = performance.now();
                        const duration = (currentTime - startTime) / 1000;


                        if (currentTime - lastUpdate > 100) {
                            const speedBps = receivedLength / duration;
                            const speedMbps = (speedBps * 8) / (1000 * 1000);
                            const percent = Math.min((receivedLength / contentLength) * 100, 100);

                            progressEl.style.width = `${percent}%`;
                            speedEl.textContent = speedMbps.toFixed(2);
                            statusEl.textContent = `Downloaded ${(receivedLength / (1024 * 1024)).toFixed(1)} MB`;
                            lastUpdate = currentTime;
                        }


                        if (duration > 15 || receivedLength > 50000000) {
                            controller.abort();
                            break;
                        }
                    }


                    const endTime = performance.now();
                    const duration = (endTime - startTime) / 1000;
                    const speedBps = receivedLength / duration;
                    const speedMbps = (speedBps * 8) / (1000 * 1000);

                    return speedMbps;

                } catch (error) {
                    if (signal.aborted && error.name === 'AbortError') {







                        throw error;
                    }
                    throw error;
                }
            };

            try {
                let speedMbps;
                try {
                    speedMbps = await runTest(CLOUDFLARE_SPEED_URL);
                } catch (e) {
                    if (signal.aborted) throw e;
                    console.warn("Primary speed test failed, trying fallback.", e);
                    speedMbps = await runTest(FALLBACK_SPEED_URL, true);
                }

                // Show Result
                modal.innerHTML = `
                     <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md border border-green-500/50 flex flex-col items-center transform scale-100 transition-transform duration-300">
                        <div class="flex items-center justify-center mb-4">
                            <i class="fas fa-check-circle text-green-500 text-5xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">Test Complete</h3>
                        <div class="text-5xl font-mono font-bold text-white mb-2">
                            ${speedMbps.toFixed(2)} <span class="text-xl text-gray-400">Mbps</span>
                        </div>
                        <p class="text-gray-400 mb-6 text-center">
                            Your connection is <span class="text-green-400 font-bold">${speedMbps > 50 ? 'Excellent' : speedMbps > 10 ? 'Good' : 'Slow'}</span>
                        </p>
                        <button onclick="document.getElementById('speed-test-modal').remove()" 
                                class="px-8 py-3 rounded-lg bg-zenith-purple text-white font-semibold hover:bg-zenith-purple/90 transition duration-150">
                            Close
                        </button>
                    </div>
                `;

            } catch (error) {
                if (signal.aborted && error.name === 'AbortError') {

                } else {
                    console.error("Speed test error:", error);
                    modal.innerHTML = `
                     <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md border border-red-500/50 flex flex-col items-center">
                        <i class="fas fa-times-circle text-red-500 text-5xl mb-4"></i>
                        <h3 class="text-xl font-bold text-white mb-4">Test Failed</h3>
                        <p class="text-gray-400 mb-6 text-center">Could not complete the speed test.</p>
                        <p class="text-gray-500 text-xs mb-6 text-center">${error.message}</p>
                        <button onclick="document.getElementById('speed-test-modal').remove()" class="px-6 py-2 rounded-lg bg-gray-600 text-white">Close</button>
                    </div>
                `;
                }
            }
        }


        const ALL_ASSETS = [
            { t: 'Baseball', u: 'https://nebulagames.us/storage/Google%20Baseball.html', c: '10b981', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Baseball.png' },
            { t: 'Bitlife', u: 'https://nebulagames.us/storage/bitlife/', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Bitlife.png' },
            { t: 'Block Blast', u: 'https://nebulagames.us/storage/Block%20Blast.html', c: '1d4ed8', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Block%20Blast.png' },
            { t: 'Blumgi Merge', u: 'https://nebulagames.us/storage/blumgimerge/', c: 'f97316', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Blumgi%20Merge.png' },
            { t: 'Bouncemasters', u: 'https://nebulagames.us/storage/Bouncemasters.html', c: 'f97316', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Bouncemasters.png' },
            { t: 'Chat', u: 'https://padlet.com/lincolnharrison8pc/zenith', c: '7c3aed', y: 'processMatrix', g: 'App', i: 'https://notbingsa.github.io/Zenith/apps/images/Chat.png' },
            { t: 'Cookie Clicker', u: 'https://nebulagames.us/storage/Cookie%20Clicker.html', c: 'd97706', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Cookie%20Clicker.png' },
            { t: 'Coreball', u: 'https://nebulagames.us/storage/Coreball.html', c: 'f87171', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Coreball.png' },
            { t: 'Cricket', u: 'https://doodlecricket.pages.dev/google-cricket/', c: 'f97316', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Cricket.png' },
            { t: 'Cut The Rope', u: 'https://nebulagames.us/storage/clcuttherope.html', c: '10b981', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Cut%20The%20Rope.png' },
            { t: 'Drive Mad', u: 'https://nebulagames.us/storage/Drive%20Mad.html', c: '34d399', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Drive%20Mad.png' },
            { t: 'Eggy Car', u: 'https://nebulagames.us/storage/eggycar/', c: 'facc15', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Eggy%20Car.png' },
            { t: 'Escape Road 2', u: 'https://nebulagames.us/storage/clescaperoad2.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Escape%20Road%202.png' },
            { t: 'Five Nights at Freddy\'s', u: 'https://nebulagames.us/storage/Five%20Nights%20at%20Freddys.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/FNAF.png' },
            { t: 'Five Nights at Freddy\'s 2', u: 'https://nebulagames.us/storage/Five%20Nights%20at%20Freddys%202.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/FNAF%202.png' },
            { t: 'Five Nights at Freddy\'s 3', u: 'https://nebulagames.us/storage/Five%20Nights%20at%20Freddys%203.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/FNAF%203.png' },
            { t: 'Five Nights at Freddy\'s 4', u: 'https://nebulagames.us/storage/Five%20Nights%20at%20Freddys%204.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/FNAF%204.png' },
            { t: 'Five Nights at Freddy\'s 4 Halloween', u: 'https://nebulagames.us/storage/Five%20Nights%20at%20Freddys%204_%20Halloween.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/FNAF%204%20Halloween.png' },
            { t: 'Five Nights at Freddy\'s Sister Location', u: 'https://nebulagames.us/storage/Five%20Nights%20at%20Freddys_%20Sister%20Location.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/FNAF%20Sister%20Location.png' },
            { t: 'Flappy Bird', u: 'https://nebulagames.us/storage/Flappy%20Bird.html', c: 'facc15', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Flappy%20Bird.png' },
            { t: 'Fluid Simulation', u: 'https://haxiomic.github.io/projects/webgl-fluid-and-particles/', c: '3b82f6', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Fluid%20Simulation.png' },
            { t: 'FNAF Pizzeria Simulator', u: 'https://nebulagames.us/storage/Five%20Nights%20at%20Freddys_%20Pizza%20Simulator.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/FNAF%20Pizzeria%20Simulator.png' },
            { t: 'FNAF Ultimate Custom Night', u: 'https://nebulagames.us/storage/Five%20Nights%20at%20Freddys_%20Ultimate%20Custom%20Night.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/FNAF%20Ultimate%20Custom%20Night.png' },
            { t: 'FNAF World', u: 'https://nebulagames.us/storage/Five%20Nights%20at%20Freddys_%20World.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/FNAF%20World.png' },
            { t: 'Friday Night Funkin', u: '', c: 'ef4444', y: 'executeVariant', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Friday%20Night%20Funkin.png' },
            { t: 'Fruit Ninja', u: 'https://nebulagames.us/storage/Fruit%20Ninja.html', c: '10b981', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Fruit%20Ninja.png' },
            { t: 'Geometry Dash Lite', u: 'https://nebulagames.us/storage/Geometry%20Dash%20Lite.html', c: '3b82f6', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Geometry%20Dash%20Lite.png' },
            { t: 'Gobble', u: 'https://nebulagames.us/storage/Gobble.html', c: '10b981', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Gobble.png' },
            { t: 'Infinite Craft', u: 'https://infinitecraftnew.com', c: '10b981', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Infinite%20Craft.png' },
            { t: 'Level Devil', u: 'https://nebulagames.us/storage/clleveldevil.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Level%20Devil.png' },
            { t: 'OvO', u: 'https://nebulagames.us/storage/ovo/', c: '111827', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/OvO.png' },
            { t: 'Paper.io 2', u: 'https://nebulagames.us/storage/paperio2/', c: 'facc15', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Paper.io%202.png' },
            { t: 'Poly Track', u: 'https://html-classic.itch.zone/html/15451330/index.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Poly%20Track.png' },
            { t: 'Ragdoll Archers', u: 'https://nebulagames.us/storage/Ragdoll%20Archers.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Ragdoll%20Archers.png' },
            { t: 'Ragdoll Hit', u: 'https://nebulagames.us/storage/Ragdoll%20Hit.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Ragdoll%20Hit.png' },
            { t: 'Sandboxels', u: 'https://shalbito.vercel.app/', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Sandboxels.png' },
            { t: 'Snake', u: 'https://googlesnakemods.com/v/current/', c: '10b981', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Snake.png' },
            { t: 'Solar Smash', u: 'https://nebulagames.us/storage/Solar%20Smash.html', c: 'f97316', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Solar%20Smash.png' },
            { t: 'Stack', u: 'https://nebulagames.us/storage/stack/', c: '3b82f6', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Stack.png' },
            { t: 'Stackball', u: 'https://nebulagames.us/storage/stackball/', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Stackball.png' },
            { t: 'Stickman Hook', u: 'https://nebulagames.us/storage/Stickman%20Hook.html', c: 'ef4444', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Stickman%20Hook.png' },
            { t: 'Stone Grass', u: 'https://nebulagames.us/storage/Stone%20Grass%20Mowing%20Simulator.html', c: '10b981', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Stone%20Grass.png' },
            { t: 'Subway Surfers', u: 'https://nebulagames.us/storage/Subway%20Surfers_%20San%20Francisco.html', c: '3b82f6', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Subway%20Surfers.png' },
            { t: 'Survival Race', u: 'https://nebulagames.us/storage/clsurvivalracev2.html', c: '7c3aed', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Survival%20Race.png' },
            { t: 'Thirty Dollar Website', u: 'https://kleeder.de/files/moai2/%F0%9F%97%Bf.html', c: '34d399', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Thirty%20Dollar%20Website.png' },
            { t: 'Tiny Fishing', u: 'https://nebulagames.us/storage/Tiny%20Fishing.html', c: 'facc15', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Tiny%20Fishing.png' },
            { t: 'Traffic Rider', u: 'https://traffic-rider.io/game/traffic-rider/', c: 'facc15', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Traffic%20Rider.png' },
            { t: 'Unblocker', u: 'https://waguri.ecolefrancophone.com/search.html', c: 'f97316', y: 'processMatrix', g: 'App', i: 'https://notbingsa.github.io/Zenith/apps/images/Unblocker.png' },
            { t: 'Yohoho.io', u: 'https://nebulagames.us/storage/yohoho/', c: '2563eb', y: 'processMatrix', g: 'Game', i: 'https://notbingsa.github.io/Zenith/games/images/Yohoho.io.png' },
        ];
        function createAssetCardHtml(asset, sizeClass = 'w-full h-auto aspect-square') {
            const title = asset.t;
            const type = asset.y;
            const safeTitle = title.replace(/'/g, "\\'");
            let clickHandler;
            if (type === 'executeVariant') {
                clickHandler = `executeVariant('${safeTitle}')`;
            } else {
                clickHandler = `processMatrix('${safeTitle}')`;
            }
            const placeholderSize = '300x300';
            const imageSrc = asset.i;
            const placeholderText = title.replace(/\s/g, '+');
            return `
                <a href="?game=${encodeURIComponent(title)}" onclick="${clickHandler}; return false;" class="block bg-gray-800 rounded-xl overflow-hidden asset-card-shadow ${sizeClass} group relative" data-category="${asset.g}">
                    <img src="${imageSrc}" 
                         alt="${title}"
                         loading="lazy"
                         onerror="handleAssetImageError(this, '${safeTitle}', '${imageSrc}')" 
                         class="w-full h-full object-cover transition duration-300 group-hover:scale-105" />
                    <div class="absolute inset-0 bg-black/30 flex items-end justify-center p-2 opacity-0 transition-opacity duration-200 group-hover:opacity-100">
                        <span class="text-sm font-semibold text-white text-center">${title}</span>
                    </div>
                </a>
            `;
        }
        function renderAllAssets() {
            const assetList = document.getElementById('game-list');
            if (assetList) {
                const allAssetsHtml = ALL_ASSETS.map(asset => createAssetCardHtml(asset)).join('');
                assetList.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 lg:gap-6 transition-opacity duration-150';
                assetList.style.opacity = 0;
                setTimeout(() => {
                    assetList.innerHTML = allAssetsHtml;
                    assetList.style.opacity = 1;
                }, 150);
            }
        }
        function renderRandomAssets() {
            const getRandomAssets = (count) => {
                const assetOnlyList = ALL_ASSETS.filter(g => g.g === 'Game');
                const shuffled = [...assetOnlyList].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            }
            const randomAssets = getRandomAssets(5);
            const randomAssetsHtml = randomAssets.map(asset => createAssetCardHtml(asset)).join('');
            const randomAssetsContainer = document.getElementById('random-assets-section');
            if (randomAssetsContainer) {
                randomAssetsContainer.innerHTML = `
                    <h3 class="section-heading-glow text-xl md:text-2xl font-semibold mb-6 text-center pt-8 text-white">
                        <i class="fas fa-dice text-zenith-purple mr-2"></i>${'Random Picks'}
                    </h3>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 lg:gap-6 mb-12">
                        ${randomAssetsHtml}
                    </div>
                `;
            }
        }
        function applySearch() {
            const searchInput = document.getElementById('game-search');
            const searchQuery = (searchInput && searchInput.value || '').toLowerCase();
            const cards = document.querySelectorAll('#game-list a');
            cards.forEach(card => {
                const titleElement = card.querySelector('span');
                const title = titleElement ? titleElement.textContent : '';
                if (title.toLowerCase().includes(searchQuery)) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
        }
        function getAssetFromUrl() {
            const params = new URLSearchParams(window.location.search);
            const game = params.get('game');
            return game ? decodeURIComponent(game) : null;
        }
        function processMatrix(title) {
            const asset = ALL_ASSETS.find(a => a.t === title);
            if (!asset) {
                console.error('Asset not found for title:', title);
                return;
            }
            processMatrixInternal(asset);
        }
        function executeVariant(title) {
            const asset = ALL_ASSETS.find(a => a.t === title);
            if (!asset) return console.error('Asset not found for title:', title);
            const assetTitle = asset.t;

            const userAgent = navigator.userAgent;
            const isMobileDevice = /Mobi|Android|iPhone|iPod|iPad/i.test(userAgent);
            const isSafariBrowser = userAgent.includes('Safari') && !userAgent.includes('Chrome');
            const loadMobileVersion = isMobileDevice || isSafariBrowser;
            let url;
            const desktopUrl = 'https://html-classic.itch.zone/html/2876359-1383886/index.html';
            const mobileUrl = 'https://html-classic.itch.zone/html/4459499/luckydog7.github.io-master/funkinmobile/game/index.html';
            if (loadMobileVersion) {
                url = mobileUrl;
            } else {
                url = desktopUrl;
            }
            const tempAsset = { ...asset, u: url };
            processMatrixInternal(tempAsset);
        }
        function processMatrixInternal(asset) {
            const title = asset.t;
            const url = asset.u;

            if (!url) {
                console.error('Asset URL is empty for title:', title, 'Cannot load.');
                return;
            }
            // Adblocker Check
            if (BLOCKED_DOMAINS.some(d => url.includes(d))) {
                console.warn(`Blocked restricted URL for asset: ${title}`);
                return;
            }
            const isFixedSize = false;
            let targetWidth = '100%';
            let targetHeight = '100%';
            if (labelRegistry) labelRegistry.textContent = title;
            if (mainPanel) {
                mainPanel.classList.add('hidden');
            }
            const secretContent = document.getElementById('secret-mode-content');
            if (secretContent) {
                secretContent.classList.add('hidden');
            }
            if (renderTarget) {
                renderTarget.className = 'relative w-full h-[80vh] mx-auto md:max-w-5xl rounded-2xl overflow-hidden shadow-2xl transition-all duration-300';
                renderTarget.style.height = 'calc(100vh - 100px)';
                renderTarget.innerHTML = '';
                renderTarget.classList.remove('hidden');
            } else {
                return;
            }
            removeInfoSplash();
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'loading-overlay';
            loadingOverlay.className = 'absolute inset-0 bg-zenith-dark/95 flex flex-col items-center justify-center p-8 z-30 rounded-2xl transition-opacity duration-500';
            loadingOverlay.innerHTML = `
                <div class="rounded-spinner mb-4"></div>
                <h3 class="text-xl font-semibold mb-1 text-white">Loading:</h3>
                <p class="text-2xl font-bold text-zenith-purple text-center">${title}</p>
                <div class="mt-4 w-48 h-2 bg-gray-700 rounded-full overflow-hidden">
                    <div id="loading-bar" class="h-full bg-zenith-purple transition-all duration-300" style="width: 0%"></div>
                </div>
            `;
            const loadingBar = loadingOverlay.querySelector('#loading-bar');
            let progress = 0;
            const iframe = document.createElement('iframe');
            iframe.id = 'asset-iframe';

            const interval = setInterval(() => {
                if (progress < 70) {
                    progress += 10;
                    if (loadingBar) loadingBar.style.width = `${progress}%`;
                } else {
                    clearInterval(interval);
                    iframe.src = url;
                }
            }, 50);

            const controlBar = document.createElement('div');
            controlBar.className = 'asset-control-bar';



            const displayToggleButton = document.createElement('button');
            displayToggleButton.id = 'fullscreen-toggle-button';
            displayToggleButton.className = 'fullscreen-button';
            displayToggleButton.innerHTML = '<i id="fs-icon" class="fas fa-expand"></i>';
            displayToggleButton.onclick = () => adjustCanvasGeometry(renderTarget);
            // Mute/Unmute Button
            const muteButton = document.createElement('button');
            muteButton.className = 'fullscreen-button';
            muteButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
            let isMuted = false;

            muteButton.onclick = () => {
                isMuted = !isMuted;

                // 1. Update UI
                if (isMuted) {
                    muteButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
                } else {
                    muteButton.innerHTML = '<i class="fas fa-volume-up"></i>';
                }

                // 2. Send message to parent (index.html) to mute the iframe
                try {
                    window.parent.postMessage({ type: 'MUTE_IFRAME', muted: isMuted }, '*');
                } catch (e) {
                    console.warn('Could not send mute message to parent:', e);
                }
            };
            controlBar.appendChild(muteButton);

            controlBar.appendChild(displayToggleButton);


            iframe.className = 'border-none opacity-0 transition-opacity duration-500';
            if (isFixedSize) {
                iframe.style.width = targetWidth;
                iframe.style.height = targetHeight;
                iframe.style.display = 'block';
            } else {
                iframe.className += ' w-full h-full';
            }

            iframe.setAttribute('allow', 'fullscreen'); // Removed autoplay to "auto-mute" where possible
            iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms'); // No popups = rough adblock
            iframe.setAttribute('allowfullscreen', 'true');
            iframe.setAttribute('loading', 'lazy');
            const centeringWrapper = document.createElement('div');
            centeringWrapper.className = 'asset-iframe-content';
            centeringWrapper.appendChild(iframe);
            renderTarget.appendChild(controlBar);
            renderTarget.appendChild(centeringWrapper);
            renderTarget.appendChild(loadingOverlay);
            iframe.onload = () => {
                clearInterval(interval);
                if (loadingBar) loadingBar.style.width = '100%';
                loadingOverlay.style.opacity = '0';
                iframe.classList.remove('opacity-0');
                setTimeout(() => {
                    loadingOverlay.remove();
                }, 500);


                try {
                    // INFO: Attempting to auto-mute game media as requested.
                    const mediaElements = iframe.contentWindow.document.querySelectorAll('video, audio');
                    mediaElements.forEach(media => {
                        media.muted = true;
                    });
                } catch (e) {
                    // This block WILL fail for cross-origin iframes.
                    // The user requested to "EXPLAIN, NOT FIX" this error, so we log it clearly.
                    console.log("Note: Auto-mute unavailable for this game (likely cross-origin). Use in-game settings.");
                }
            };

            iframe.onerror = () => {
                console.error(`DEVELOPER ERROR: Iframe failed to load content for "${title}" (${url}). Likely a 404 or connection Refused.`);
                // User feedback: The loading overlay will eventually time out or we can show a message.
                // Since iframes rarely fire onerror for HTTP errors, the timeout is the backup.
                loadingOverlay.remove();
            };


            setTimeout(() => {
                if (document.body.contains(loadingOverlay)) {
                    console.warn(`DEVELOPER WARNING: Game load timed out for "${title}". It might be blocked or very slow.`);
                    // User feedback is implicit (loading disappears), but we can log for dev.
                    loadingOverlay.style.opacity = '0';
                    iframe.classList.remove('opacity-0');
                    setTimeout(() => loadingOverlay.remove(), 500);
                }
            }, 15000);


            setTimeout(() => {
                if (document.body.contains(loadingOverlay)) {
                    const skipButton = document.createElement('button');
                    skipButton.className = 'mt-6 px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors duration-200 shadow-lg border border-gray-500';
                    skipButton.innerHTML = '<i class="fas fa-forward mr-2"></i>Skip Loading';
                    skipButton.onclick = () => {
                        console.log("User skipped loading.");
                        loadingOverlay.style.opacity = '0';
                        iframe.classList.remove('opacity-0');
                        setTimeout(() => loadingOverlay.remove(), 500);
                    };
                    loadingOverlay.appendChild(skipButton);
                }
            }, 5000);
        }
        function adjustCanvasGeometry(container) {
            const isFullView = container.classList.contains('full-view');
            const fsButton = document.getElementById('fullscreen-toggle-button');

            if (isFullView) {

                container.classList.remove('full-view');
                fsButton.innerHTML = '<i class="fas fa-expand"></i>';


                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            } else {

                container.classList.add('full-view');
                fsButton.innerHTML = '<i class="fas fa-compress"></i>';


                if (container.requestFullscreen) {
                    container.requestFullscreen();
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.mozRequestFullScreen) {
                    container.msRequestFullscreen();
                }
            }
        }
        function resetViewport() {



            const activeIframe = document.getElementById('asset-iframe');
            if (activeIframe) {
                try {
                    const mediaElements = activeIframe.contentWindow.document.querySelectorAll('video, audio');
                    mediaElements.forEach(media => {
                        media.muted = true;
                        media.pause();
                    });
                } catch (e) {

                }
            }

            if (labelRegistry) labelRegistry.textContent = 'Homepage';
            if (mainPanel) mainPanel.classList.remove('hidden');
            const secretContent = document.getElementById('secret-mode-content');
            if (secretContent) {
                secretContent.classList.add('hidden');
                document.getElementById('tester-catalog-grid-wrapper').classList.add('hidden');
                document.getElementById('testAllGamesButton').textContent = 'Test All Games';
                document.getElementById('game-cards-container').innerHTML = '';
            }
            if (renderTarget) renderTarget.innerHTML = '';
            if (renderTarget) renderTarget.className = 'hidden relative';
            const overlay = document.getElementById('loading-overlay');
            if (overlay) overlay.remove();
            if (document.fullscreenElement) {
                document.exitFullscreen().catch(() => { });
            }
        }
        function toggleSecretModal(show) {
            const modal = document.getElementById('secret-modal');
            const input = document.getElementById('secret-input');
            const message = document.getElementById('secret-message');
            if (show) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                input.value = '';
                message.classList.add('hidden');
                input.onkeydown = (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        checkSecretCode();
                    }
                };
                setTimeout(() => input.focus(), 100);
            } else {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                input.onkeydown = null;
            }
        }
        function checkSecretCode() {
            const input = document.getElementById('secret-input');
            const message = document.getElementById('secret-message');
            const code = input.value.trim();
            if (code === 'tester') {
                applySecretMode(true);
                toggleSecretModal(false);
            } else {
                message.textContent = "Invalid key. Access denied.";
                message.classList.remove('hidden');
                input.value = '';
                input.focus();
            }
        }

        function applySecretMode(activate) {
            const homepage = document.getElementById('homepage-section');
            const assetContainer = document.getElementById('asset-container');
            const secretContent = document.getElementById('secret-mode-content');
            const headerTitle = document.getElementById('header-title');
            const secretToggle = document.getElementById('secret-mode-toggle');
            const primaryMarker = document.getElementById('main-zenith-title');

            if (activate) {
                homepage.classList.add('hidden');
                assetContainer.classList.add('hidden');
                secretContent.classList.remove('hidden');
                headerTitle.textContent = 'Tester';
                primaryMarker.textContent = 'Tester';
                secretToggle.innerHTML = '<i class="fas fa-lock-open"></i>';
                secretToggle.classList.remove('hover:bg-zenith-purple/50');
                secretToggle.classList.add('text-zenith-purple');
                window.scrollTo(0, 0);
            } else {
                homepage.classList.remove('hidden');
                secretContent.classList.add('hidden');
                if (labelRegistry) labelRegistry.textContent = 'Homepage';
                if (primaryMarker) primaryMarker.textContent = 'Zenith';
                secretToggle.innerHTML = '<i class="fas fa-lock"></i>';
                secretToggle.classList.add('hover:bg-zenith-purple/50');
                secretToggle.classList.remove('text-zenith-purple');
                resetViewport();
            }
        }
        function handleTesterAssetLoad(isError = false, iframeElement = null) {
            testerLoadCount++;
            const progressBar = document.getElementById('tester-loading-bar');
            const statusText = document.getElementById('tester-loading-status');

            // Developer Logging
            if (isError && iframeElement) {
                console.error(`DEVELOPER ERROR: Tester asset failed to load via onerror. Src: ${iframeElement.dataset.src}`);
                const container = iframeElement.parentElement;
                const errorIndicator = container.querySelector('.tester-error-indicator');
                if (errorIndicator) errorIndicator.classList.remove('hidden');
            }

            const progress = (testerLoadCount / testerTotalAssets) * 100;
            if (progressBar) progressBar.style.width = `${progress.toFixed(0)}%`;
            if (statusText) statusText.textContent = `Loading Assets (${testerLoadCount} / ${testerTotalAssets})`;

            checkTesterCompletion();
        }

        function checkTesterCompletion(force = false) {
            if (force || testerLoadCount >= testerTotalAssets) {
                const banner = document.getElementById('tester-loading-banner');
                const container = document.getElementById('game-cards-container');
                const statusText = document.getElementById('tester-loading-status');

                // If forced, ensure we don't double-animate or get weird states if already done
                if (banner && !banner.classList.contains('hidden')) {
                    banner.classList.remove('bg-indigo-900/90');
                    banner.classList.add('bg-green-700/90');
                    if (statusText) statusText.textContent = force ? `Done (Timed Out)` : `All ${testerTotalAssets} Assets Loaded!`;

                    setTimeout(() => {
                        banner.classList.add('opacity-0');
                        setTimeout(() => {
                            banner.classList.add('hidden');
                            if (container) {
                                container.classList.remove('opacity-0', 'invisible');
                                container.classList.add('opacity-100');
                            }
                        }, 300);
                    }, 500);
                }
            }
        }
        function createTesterIframe(title, url, category, color) {
            const safeTitle = title.replace(/'/g, "\\'");
            const safeUrl = url.replace(/'/g, "\\'");
            return `
                <div class="bg-gray-800 rounded-xl overflow-hidden shadow-2xl relative border border-zenith-purple/50 aspect-video group" style="flex: 0 0 calc(50% - 0.5rem);">
                    <div class="absolute top-0 left-0 right-0 bg-black/70 p-1 flex justify-between items-center z-20">
                        <span class="text-xs font-semibold text-white truncate px-1">${title}</span>
                        <span class="text-xs font-medium text-zenith-blue bg-blue-900/70 px-1.5 py-0.5 rounded-full">${category}</span>
                    </div>
                    <iframe 
                        data-src="${url}"
                        class="tester-iframe absolute inset-0 w-full h-full border-none transition-opacity duration-500"
                        onload="handleTesterAssetLoad(false, this)"
                        onerror="handleTesterAssetLoad(true, this)"
                        loading="lazy"
                        loading="lazy"
                        sandbox="allow-scripts allow-same-origin allow-forms"
                        allowfullscreen="true">
                    </iframe>
                    <button onclick="launchTesterAsset('${safeUrl}', '${safeTitle}', '${color}')" 
                            class="absolute bottom-2 right-2 p-1.5 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition duration-300 z-30 hover:bg-zenith-purple/70">
                        <i class="fas fa-expand text-sm"></i>
                    </button>
                    <!-- Error Indicator (Hidden by default) -->
                    <div class="absolute inset-0 flex items-center justify-center bg-red-900/80 hidden pointer-events-none z-10 tester-error-indicator">
                        <span class="text-white font-bold text-xs">Load Failed</span>
                    </div>
                </div>
            `;
        }
        function generateTesterCatalog() {
            testerAssetList = [];
            const desktopUrl = 'https://html-classic.itch.zone/html/2876359-1383886/index.html';
            const mobileUrl = 'https://html-classic.itch.zone/html/4459499/luckydog7.github.io-master/funkinmobile/game/index.html';
            for (const asset of ALL_ASSETS) {
                const decodedTitle = asset.t;
                if (asset.y === 'executeVariant') {
                    const fnfTitle = decodedTitle;
                    testerAssetList.push({ t: `${fnfTitle} (Desktop)`, u: desktopUrl, g: asset.g, c: asset.c, i: asset.i });
                    testerAssetList.push({ t: `${fnfTitle} (Mobile)`, u: mobileUrl, g: asset.g, c: asset.c, i: asset.i });
                } else {
                    testerAssetList.push({ ...asset, t: decodedTitle });
                }
            }
            testerTotalAssets = testerAssetList.length;
            const cardsHtml = testerAssetList.map(asset => {
                return createTesterIframe(asset.t, asset.u, asset.g, asset.c);
            }).join('');
            return cardsHtml;
        }
        function loadTesterIframesStaggered(startIndex) {
            const iframes = document.querySelectorAll('#game-cards-container .tester-iframe');
            const BATCH_SIZE = 3; // Load 3 at a time to keep UI responsive

            for (let i = startIndex; i < Math.min(startIndex + BATCH_SIZE, iframes.length); i++) {
                const iframe = iframes[i];
                const asset = testerAssetList[i];
                if (asset && iframe && !iframe.src) {
                    iframe.src = iframe.getAttribute('data-src');
                }
            }

            if (startIndex + BATCH_SIZE < iframes.length) {
                // Schedule next batch
                setTimeout(() => loadTesterIframesStaggered(startIndex + BATCH_SIZE), 200);
            }
        }
        function toggleTesterCatalog() {
            const gridWrapper = document.getElementById('tester-catalog-grid-wrapper');
            const button = document.getElementById('testAllGamesButton');
            const container = document.getElementById('game-cards-container');
            const banner = document.getElementById('tester-loading-banner');
            if (gridWrapper.classList.contains('hidden')) {
                testerLoadCount = 0;
                container.innerHTML = generateTesterCatalog();
                // Hide container initially
                container.classList.add('opacity-0', 'invisible');
                banner.classList.remove('hidden', 'opacity-0', 'bg-green-700/90');
                banner.classList.add('bg-indigo-900/90');
                document.getElementById('tester-loading-bar').style.width = '0%';
                document.getElementById('tester-loading-status').textContent = `Loading Assets (0 / ${testerTotalAssets})`;
                gridWrapper.classList.remove('hidden');
                button.textContent = 'Hide Live Grid';

                // Start loading
                // Start loading in staggered chunks to prevent UI freeze
                setTimeout(() => loadTesterIframesStaggered(0), 100);

                // SAFETY TIMEOUT: If not all assets report loaded in 30 seconds, force show the grid.
                // This prevents the "stuck loading" issue if an iframe 404s/hangs without firing events.
                setTimeout(() => {
                    if (testerLoadCount < testerTotalAssets) {
                        console.warn("DEVELOPER WARNING: Test Grid load timed out. Forcing display.");
                        checkTesterCompletion(true);
                    }
                }, 30000);
            } else {
                gridWrapper.classList.add('hidden');
                button.textContent = 'Test All Games';
                container.innerHTML = '';
                banner.classList.add('hidden');
            }
        }
        function launchTesterAsset(url, title, color) {
            const secretContent = document.getElementById('secret-mode-content');
            if (secretContent) {
                secretContent.classList.add('hidden');
            }
            if (labelRegistry) labelRegistry.textContent = title;
            if (renderTarget) {
                renderTarget.className = 'relative w-full h-[80vh] mx-auto md:max-w-5xl rounded-2xl overflow-hidden shadow-2xl transition-all duration-300';
                renderTarget.style.height = 'calc(100vh - 100px)';
                renderTarget.innerHTML = '';
                renderTarget.classList.remove('hidden');
            } else {
                return;
            }
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'loading-overlay';
            loadingOverlay.className = 'absolute inset-0 bg-zenith-dark/95 flex flex-col items-center justify-center p-8 z-30 rounded-2xl transition-opacity duration-500';
            loadingOverlay.innerHTML = `
                <div class="rounded-spinner mb-4"></div>
                <h3 class="text-xl font-semibold mb-1 text-white">Loading Test:</h3>
                <p class="text-2xl font-bold text-zenith-purple text-center">${title}</p>
                <div class="mt-4 w-48 h-2 bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-zenith-purple w-full"></div>
                </div>
            `;
            const controlBar = document.createElement('div');
            controlBar.className = 'asset-control-bar';
            const backButton = document.createElement('button');
            backButton.className = 'fullscreen-button';
            backButton.innerHTML = '<i class="fas fa-arrow-left"></i>';
            backButton.onclick = () => {
                resetViewport();
                applySecretMode(true);
            };
            controlBar.appendChild(backButton);



            const displayToggleButton = document.createElement('button');
            displayToggleButton.id = 'fullscreen-toggle-button';
            displayToggleButton.className = 'fullscreen-button';
            displayToggleButton.innerHTML = '<i id="fs-icon" class="fas fa-expand"></i>';
            displayToggleButton.onclick = () => adjustCanvasGeometry(renderTarget);
            controlBar.appendChild(displayToggleButton);
            const iframe = document.createElement('iframe');
            iframe.id = 'asset-iframe';
            iframe.className = 'border-none opacity-0 transition-opacity duration-500 w-full h-full';
            iframe.setAttribute('allow', 'fullscreen');
            iframe.setAttribute('allowfullscreen', 'true');
            iframe.setAttribute('loading', 'lazy');
            iframe.src = url;
            const centeringWrapper = document.createElement('div');
            centeringWrapper.className = 'asset-iframe-content';
            centeringWrapper.appendChild(iframe);
            renderTarget.appendChild(controlBar);
            renderTarget.appendChild(centeringWrapper);
            renderTarget.appendChild(loadingOverlay);
            iframe.onload = () => {
                loadingOverlay.style.opacity = '0';
                iframe.classList.remove('opacity-0');
                setTimeout(() => {
                    loadingOverlay.remove();
                }, 500);


                try {
                    const mediaElements = iframe.contentWindow.document.querySelectorAll('video, audio');
                    mediaElements.forEach(media => {
                        media.muted = true;
                    });
                } catch (e) {

                }
            };


            setTimeout(() => {
                if (renderTarget.contains(loadingOverlay)) {
                    const skipButton = document.createElement('button');
                    skipButton.className = 'mt-6 px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors duration-200 shadow-lg border border-gray-500';
                    skipButton.innerHTML = '<i class="fas fa-forward mr-2"></i>Skip Loading';
                    skipButton.onclick = () => {
                        console.log("User skipped loading (Tester).");
                        loadingOverlay.style.opacity = '0';
                        iframe.classList.remove('opacity-0');
                        setTimeout(() => loadingOverlay.remove(), 500);
                    };
                    loadingOverlay.appendChild(skipButton);
                }
            }, 5000);
        }
        window.addEventListener('popstate', (event) => {
            const title = getAssetFromUrl();
            if (title) {
                const asset = ALL_ASSETS.find(a => a.t === title);
                if (asset) {
                    if (asset.y === 'executeVariant') {
                        executeVariant(title);
                    } else {
                        processMatrix(title);
                    }
                } else {
                    try {
                        history.replaceState(null, '', window.location.pathname);
                    } catch (e) {
                        console.error("History replace failed on invalid title, continuing normally.");
                    }
                    resetViewport();
                }
            } else {
                resetViewport();
            }
        });
        document.addEventListener('DOMContentLoaded', () => {
            mainPanel = document.getElementById('homepage-section');
            renderTarget = document.getElementById('asset-container');
            labelRegistry = document.getElementById('header-title');
            primaryMarker = document.getElementById('main-zenith-title');

            const titleFromUrl = getAssetFromUrl();
            if (titleFromUrl) {
                const asset = ALL_ASSETS.find(a => a.t === titleFromUrl);
                if (asset) {
                    if (asset.y === 'executeVariant') {
                        executeVariant(titleFromUrl);
                    } else {
                        processMatrix(titleFromUrl);
                    }
                } else {
                    try {
                        history.replaceState(null, '', window.location.pathname);
                    } catch (e) {
                        console.error("History replace failed on invalid title, continuing normally.");
                    }
                    loadHomePage();
                }
            } else {
                loadHomePage();
            }
            function loadHomePage() {
                const searchInput = document.getElementById('game-search');
                if (searchInput) {
                    searchInput.placeholder = '';
                }
                document.title = 'Zenith' + ' - ' + 'Unblocked Games';
                if (labelRegistry) labelRegistry.textContent = 'Homepage';
                if (primaryMarker) primaryMarker.textContent = 'Zenith';

                removeInfoSplash();
                renderRandomAssets();
                renderAllAssets();


                setTimeout(() => {
                    checkInternetSpeed();
                }, 500);
            }


            showLegalDisclaimer();
        });
    </script>
</head>

<body class="font-sans bg-gray-900 text-gray-100">
    <div id="website-splash-loader"
        class="fixed inset-0 z-[10000] bg-zenith-dark flex flex-col items-center justify-center transition-opacity duration-300">
        <img src="https://notbingsa.github.io/Zenith/ui/logo.png" alt="Zenith Logo"
            class="w-16 h-16 mb-4 animate-pulse object-contain" />
        <h2 id="splash-title" class="text-3xl font-extrabold zenith-title-glow tracking-tighter">Zenith</h2>
        <p class="text-sm text-gray-400 mt-2">Loading interface...</p>
    </div>
    <div id="secret-modal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-[1000] p-4"
        onclick="if(event.target.id === 'secret-modal') toggleSecretModal(false)">
        <div
            class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-sm border border-zenith-purple/50 transform scale-100 transition-transform duration-300">
            <h3 class="text-2xl font-bold text-white mb-6 text-center">Enter Code</h3>
            <input type="password" id="secret-input" value=""
                class="w-full py-3 px-4 pl-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-zenith-blue mb-4" />
            <p id="secret-message" class="text-sm text-red-400 mb-4 hidden"></p>
            <div class="flex justify-between space-x-3">
                <button onclick="toggleSecretModal(false)"
                    class="flex-1 py-2 rounded-lg bg-gray-600 text-white font-semibold hover:bg-gray-700 transition duration-150">
                    Cancel
                </button>
                <button onclick="checkSecretCode()"
                    class="flex-1 py-2 rounded-lg bg-zenith-purple text-white font-semibold hover:bg-zenith-purple/90 transition duration-150">
                    Unlock
                </button>
            </div>
        </div>
    </div>
    <header
        class="py-3 px-4 md:px-8 flex items-center justify-between fixed top-0 left-0 right-0 z-50 bg-black/30 backdrop-blur-sm">
        <a href="./" class="flex items-center space-x-3" onclick="applySecretMode(false); return false;">
            <img src="https://notbingsa.github.io/Zenith/ui/logo.png" alt="Zenith Logo"
                class="w-10 h-10 object-contain" />
            <h1 id="header-title" class="text-xl md:text-3xl font-bold"></h1>
        </a>
        <button id="secret-mode-toggle"
            class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-zenith-purple/50 transition duration-200"
            onclick="toggleSecretModal(true)">
            <i class="fas fa-lock"></i>
        </button>
    </header>
    <main class="pt-24 md:pt-32 pb-8 px-4 md:px-8 max-w-7xl mx-auto">
        <div id="secret-mode-content" class="hidden text-center py-10 rounded-xl">
            <h2 class="text-4xl font-extrabold text-blue-400 mb-6">Tester Mode</h2>
            <p class="text-lg text-gray-400 mb-8">Click below to load the live asset testing grid.</p>
            <button id="testAllGamesButton"
                class="px-8 py-3 text-lg font-semibold text-white rounded-xl shadow-lg bg-zenith-purple hover:bg-zenith-blue transition duration-200"
                onclick="toggleTesterCatalog();">
                Test All Games
            </button>
            <button id="testBadInternetButton"
                class="ml-4 px-8 py-3 text-lg font-semibold text-white rounded-xl shadow-lg bg-yellow-600 hover:bg-yellow-500 transition duration-200"
                onclick="testBadInternet();">
                <i class="fas fa-wifi mr-2"></i>Test Bad Internet
            </button>
            <button id="testSpeedButton"
                class="ml-4 px-8 py-3 text-lg font-semibold text-white rounded-xl shadow-lg bg-blue-600 hover:bg-blue-500 transition duration-200"
                onclick="measureCloudflareSpeed();">
                <i class="fas fa-tachometer-alt mr-2"></i>Test Speed
            </button>
            <div id="tester-catalog-grid-wrapper" class="hidden mt-12 w-full mx-auto relative">
                <h3 class="text-2xl font-bold text-gray-200 mb-6 border-b border-gray-700 pb-3">Live Test Grid</h3>
                <div id="tester-loading-banner"
                    class="fixed inset-x-0 mx-auto w-full max-w-7xl top-24 md:top-32 p-4 bg-indigo-900/90 border border-indigo-700 rounded-xl shadow-2xl transition-opacity duration-300 z-45 hidden">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-sync-alt w-5 h-5 text-indigo-400 animate-spin"></i>
                        <span id="tester-loading-status" class="text-lg font-semibold text-white">
                            Initializing...
                        </span>
                    </div>
                    <div class="mt-3 w-full bg-indigo-200 rounded-full h-2.5">
                        <div id="tester-loading-bar"
                            class="bg-indigo-400 h-2.5 rounded-full transition-all duration-500" style="width: 0%">
                        </div>
                    </div>
                </div>
                <div id="game-cards-container" class="flex flex-wrap gap-4">
                </div>
            </div>
        </div>
        <div id="homepage-section">
            <section class="text-center py-16">
                <h2 id="main-zenith-title"
                    class="text-6xl md:text-8xl font-extrabold zenith-title-glow tracking-tighter mb-4"></h2>

                <div class="w-full h-0.5 bg-gradient-to-r from-transparent via-zenith-purple/50 to-transparent mb-0">
                </div>
            </section>
            <div id="random-assets-section" class="mb-4">
            </div>
            <section class="text-center">
                <div class="mb-10 w-full max-w-xl mx-auto relative flex items-center pt-8">
                    <input type="text" id="game-search" placeholder=""
                        class="w-full p-3 pl-12 bg-gray-700/50 border border-zenith-purple/50 rounded-lg text-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-zenith-purple"
                        oninput="applySearch()" />
                    <svg class="absolute left-4 w-5 h-5 text-gray-400" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-4.35-4.35M17 11a6 6 0 11-12 0 6 6 0 0112 0z"></path>
                    </svg>
                </div>
                <div id="game-list"
                    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 lg:gap-6 transition-opacity duration-150">
                </div>
            </section>
        </div>
        <div id="asset-container" class="hidden relative"></div>
    </main>
</body>

</html>
